{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport axios from \"axios\";\nimport config from \"../../config.json\";\nimport { getSecuretValueFor, secureSave, deleteSecuretValueFor } from \"../secureStorage/index\";\nimport FormData from \"form-data\";\nmodule.exports = {\n  createMb: createMb,\n  deleteMb: deleteMb,\n  uploadMb: uploadMb,\n  updateMb: updateMb,\n  getAllMyMb: getAllMyMb\n};\nvar baseURL = config.baseUrl + \"/mbs\";\n\nfunction createMb(params) {\n  var token, config;\n  return _regeneratorRuntime.async(function createMb$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          console.log(params);\n          _context2.next = 3;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 3:\n          token = _context2.sent;\n          config = {\n            method: \"post\",\n            url: baseURL + \"/create\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            },\n            data: JSON.stringify(params)\n          };\n          _context2.next = 7;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee(response) {\n            return _regeneratorRuntime.async(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    console.log(response);\n\n                  case 1:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 7:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction updateMb(id, params) {\n  var config;\n  return _regeneratorRuntime.async(function updateMb$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          config = {\n            method: \"put\",\n            url: baseURL + \"/\" + id,\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            },\n            data: JSON.stringify(params)\n          };\n          _context4.next = 3;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee2(response) {\n            return _regeneratorRuntime.async(function _callee2$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    console.log(response.data);\n                    _context3.next = 3;\n                    return _regeneratorRuntime.awrap(secureSave(\"username\", response.data.username));\n\n                  case 3:\n                    _context3.next = 5;\n                    return _regeneratorRuntime.awrap(secureSave(\"password\", params.password));\n\n                  case 5:\n                    _context3.next = 7;\n                    return _regeneratorRuntime.awrap(secureSave(\"anonymous\", String(params.anonymous)));\n\n                  case 7:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 3:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction uploadMb(image, realm) {\n  var token, uriParts, fileType, formData, options;\n  return _regeneratorRuntime.async(function uploadMb$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          if (image.cancelled) {\n            _context8.next = 13;\n            break;\n          }\n\n          _context8.next = 3;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 3:\n          token = _context8.sent;\n          uriParts = image.uri.split(\".\");\n          fileType = uriParts[uriParts.length - 1];\n          formData = new FormData();\n          formData.append(\"file\", {\n            uri: image.uri,\n            name: \"photo.\" + fileType,\n            type: \"image/\" + fileType\n          });\n          formData.append(\"realm\", JSON.stringify({\n            realm: realm\n          }));\n          options = {\n            method: \"POST\",\n            body: formData,\n            headers: {\n              Accept: \"application/json\",\n              Authorization: \"Bearer \" + token,\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          };\n          _context8.next = 12;\n          return _regeneratorRuntime.awrap(fetch(baseURL + \"/upload\", options).then(function _callee3(response) {\n            return _regeneratorRuntime.async(function _callee3$(_context5) {\n              while (1) {\n                switch (_context5.prev = _context5.next) {\n                  case 0:\n                    if (!response.ok) {\n                      _context5.next = 4;\n                      break;\n                    }\n\n                    _context5.next = 3;\n                    return _regeneratorRuntime.awrap(response.json());\n\n                  case 3:\n                    return _context5.abrupt(\"return\", _context5.sent);\n\n                  case 4:\n                    _context5.next = 6;\n                    return _regeneratorRuntime.awrap(response.json());\n\n                  case 6:\n                    throw _context5.sent;\n\n                  case 7:\n                  case \"end\":\n                    return _context5.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).then(function _callee4(response) {\n            return _regeneratorRuntime.async(function _callee4$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    _context6.next = 2;\n                    return _regeneratorRuntime.awrap(response);\n\n                  case 2:\n                    return _context6.abrupt(\"return\", _context6.sent);\n\n                  case 3:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function _callee5(error) {\n            return _regeneratorRuntime.async(function _callee5$(_context7) {\n              while (1) {\n                switch (_context7.prev = _context7.next) {\n                  case 0:\n                    _context7.next = 2;\n                    return _regeneratorRuntime.awrap(error.message);\n\n                  case 2:\n                    throw _context7.sent;\n\n                  case 3:\n                  case \"end\":\n                    return _context7.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }));\n\n        case 12:\n          return _context8.abrupt(\"return\", _context8.sent);\n\n        case 13:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction deleteMb(id) {\n  var token, config;\n  return _regeneratorRuntime.async(function deleteMb$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 2:\n          token = _context10.sent;\n          config = {\n            method: \"delete\",\n            url: baseURL + \"/\" + id,\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            }\n          };\n          _context10.next = 6;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee6(response) {\n            return _regeneratorRuntime.async(function _callee6$(_context9) {\n              while (1) {\n                switch (_context9.prev = _context9.next) {\n                  case 0:\n                    console.log(response.data);\n\n                  case 1:\n                  case \"end\":\n                    return _context9.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 6:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction getAllMyMb(page) {\n  var token, config;\n  return _regeneratorRuntime.async(function getAllMyMb$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          _context12.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 2:\n          token = _context12.sent;\n          config = {\n            method: \"get\",\n            url: baseURL + \"/my\",\n            params: {\n              page: 1\n            },\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            }\n          };\n          _context12.next = 6;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee7(response) {\n            return _regeneratorRuntime.async(function _callee7$(_context11) {\n              while (1) {\n                switch (_context11.prev = _context11.next) {\n                  case 0:\n                    return _context11.abrupt(\"return\", response.data);\n\n                  case 1:\n                  case \"end\":\n                    return _context11.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 6:\n          return _context12.abrupt(\"return\", _context12.sent);\n\n        case 7:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}","map":{"version":3,"names":["axios","config","getSecuretValueFor","secureSave","deleteSecuretValueFor","FormData","module","exports","createMb","deleteMb","uploadMb","updateMb","getAllMyMb","baseURL","baseUrl","params","console","log","token","method","url","headers","Authorization","data","JSON","stringify","then","response","catch","error","message","id","username","password","String","anonymous","image","realm","cancelled","uriParts","uri","split","fileType","length","formData","append","name","type","options","body","Accept","fetch","ok","json","page"],"sources":["C:/Users/lyes9/Documents/GitHub/stepnstats/stepnstats/front/services/mbs/index.js"],"sourcesContent":["import axios from \"axios\";\r\nimport config from \"../../config.json\";\r\nimport {\r\n  getSecuretValueFor,\r\n  secureSave,\r\n  deleteSecuretValueFor,\r\n} from \"../secureStorage/index\";\r\nimport FormData from \"form-data\";\r\n\r\nmodule.exports = {\r\n  createMb,\r\n  deleteMb,\r\n  uploadMb,\r\n  updateMb,\r\n  getAllMyMb,\r\n};\r\nconst baseURL = config.baseUrl + \"/mbs\";\r\nasync function createMb(params) {\r\n  console.log(params);\r\n  var token = await getSecuretValueFor(\"token\");\r\n  var config = {\r\n    method: \"post\",\r\n    url: baseURL + \"/create\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      // Save to store\r\n      console.log(response);\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function updateMb(id, params) {\r\n  var config = {\r\n    method: \"put\",\r\n    url: baseURL + \"/\" + id,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      console.log(response.data);\r\n      // Save username and password\r\n      await secureSave(\"username\", response.data.username);\r\n      await secureSave(\"password\", params.password);\r\n      await secureSave(\"anonymous\", String(params.anonymous));\r\n      // Login\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function uploadMb(image, realm) {\r\n  if (!image.cancelled) {\r\n    var token = await getSecuretValueFor(\"token\");\r\n    let uriParts = image.uri.split(\".\");\r\n    let fileType = uriParts[uriParts.length - 1];\r\n    let formData = new FormData();\r\n    formData.append(\"file\", {\r\n      uri: image.uri,\r\n      name: `photo.${fileType}`,\r\n      type: `image/${fileType}`,\r\n    });\r\n    formData.append(\"realm\", JSON.stringify({ realm }));\r\n    let options = {\r\n      method: \"POST\",\r\n      body: formData,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    };\r\n    // Start waiting screen\r\n    return await fetch(baseURL + \"/upload\", options)\r\n      .then(async (response) => {\r\n        if (response.ok) {\r\n          return await response.json();\r\n        }\r\n        throw await response.json();\r\n      })\r\n      .then(async (response) => {\r\n        return await response;\r\n      })\r\n      .catch(async function (error) {\r\n        throw await error.message;\r\n      });\r\n    // Stop wainting screen\r\n  }\r\n}\r\n\r\nasync function deleteMb(id) {\r\n  var token = await getSecuretValueFor(\"token\");\r\n  var config = {\r\n    method: \"delete\",\r\n    url: baseURL + \"/\" + id,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      console.log(response.data);\r\n      // re Mb getAllMyMb to actualize\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function getAllMyMb(page) {\r\n  var token = await getSecuretValueFor(\"token\");\r\n  var config = {\r\n    method: \"get\",\r\n    url: baseURL + \"/my\",\r\n    params: { page: 1 },\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  };\r\n\r\n  return await axios(config)\r\n    .then(async function (response) {\r\n      return response.data;\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}