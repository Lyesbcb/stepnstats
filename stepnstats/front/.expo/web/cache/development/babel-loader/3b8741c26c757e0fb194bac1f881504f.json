{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport axios from \"axios\";\nimport config from \"../../config.json\";\nimport { getSecuretValueFor, secureSave, deleteSecuretValueFor } from \"../secureStorage/index\";\nmodule.exports = {\n  registerUser: registerUser,\n  authenticateUser: authenticateUser,\n  updateUser: updateUser,\n  logoutUser: logoutUser,\n  firstLaunch: firstLaunch\n};\nvar baseURL = config.baseUrl + \"/users\";\n\nfunction authenticateUser(params) {\n  var getUsername, config;\n  return _regeneratorRuntime.async(function authenticateUser$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"username\"));\n\n        case 2:\n          getUsername = _context2.sent;\n\n          if (!getUsername) {\n            _context2.next = 8;\n            break;\n          }\n\n          params.username = getUsername;\n          _context2.next = 7;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"password\"));\n\n        case 7:\n          params.password = _context2.sent;\n\n        case 8:\n          config = {\n            method: \"post\",\n            url: baseURL + \"/authenticate\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            data: JSON.stringify(params)\n          };\n          _context2.next = 11;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee(response) {\n            return _regeneratorRuntime.async(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.next = 2;\n                    return _regeneratorRuntime.awrap(secureSave(\"token\", response.data.token));\n\n                  case 2:\n                    _context.next = 4;\n                    return _regeneratorRuntime.awrap(secureSave(\"id\", String(response.data.id)));\n\n                  case 4:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error);\n          }));\n\n        case 11:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction registerUser(params) {\n  var config;\n  return _regeneratorRuntime.async(function registerUser$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          if (params.anonymous) {\n            params.password = generatePassword(24);\n          }\n\n          config = {\n            method: \"post\",\n            url: baseURL + \"/register\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            data: JSON.stringify(params)\n          };\n          _context4.next = 4;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee2(response) {\n            return _regeneratorRuntime.async(function _callee2$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    _context3.next = 2;\n                    return _regeneratorRuntime.awrap(secureSave(\"username\", response.data.username));\n\n                  case 2:\n                    _context3.next = 4;\n                    return _regeneratorRuntime.awrap(secureSave(\"password\", params.password));\n\n                  case 4:\n                    _context3.next = 6;\n                    return _regeneratorRuntime.awrap(secureSave(\"anonymous\", String(params.anonymous)));\n\n                  case 6:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 4:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction updateUser(params) {\n  var anonymous, id, token, config;\n  return _regeneratorRuntime.async(function updateUser$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"anonymous\"));\n\n        case 2:\n          anonymous = _context6.sent;\n\n          if (anonymous) {\n            params.anonymous = false;\n          }\n\n          _context6.next = 6;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"id\"));\n\n        case 6:\n          id = _context6.sent;\n          _context6.next = 9;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 9:\n          token = _context6.sent;\n          config = {\n            method: \"put\",\n            url: baseURL + \"/\" + id,\n            headers: {\n              \"Content-Type\": \"application/json\",\n              \"Authorization\": \"Bearer \" + token\n            },\n            data: JSON.stringify(params)\n          };\n          _context6.next = 13;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee3(response) {\n            return _regeneratorRuntime.async(function _callee3$(_context5) {\n              while (1) {\n                switch (_context5.prev = _context5.next) {\n                  case 0:\n                    _context5.next = 2;\n                    return _regeneratorRuntime.awrap(secureSave(\"username\", response.data.username));\n\n                  case 2:\n                    _context5.next = 4;\n                    return _regeneratorRuntime.awrap(secureSave(\"password\", params.password));\n\n                  case 4:\n                    _context5.next = 6;\n                    return _regeneratorRuntime.awrap(secureSave(\"anonymous\", String(params.anonymous)));\n\n                  case 6:\n                  case \"end\":\n                    return _context5.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 13:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction logoutUser() {\n  return _regeneratorRuntime.async(function logoutUser$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return _regeneratorRuntime.awrap(deleteSecuretValueFor(\"token\"));\n\n        case 2:\n          _context7.next = 4;\n          return _regeneratorRuntime.awrap(deleteSecuretValueFor(\"password\"));\n\n        case 4:\n          _context7.next = 6;\n          return _regeneratorRuntime.awrap(deleteSecuretValueFor(\"username\"));\n\n        case 6:\n          _context7.next = 8;\n          return _regeneratorRuntime.awrap(deleteSecuretValueFor(\"id\"));\n\n        case 8:\n          _context7.next = 10;\n          return _regeneratorRuntime.awrap(deleteSecuretValueFor(\"anonymous\"));\n\n        case 10:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction firstLaunch() {\n  var getUsername, params;\n  return _regeneratorRuntime.async(function firstLaunch$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"username\"));\n\n        case 2:\n          getUsername = _context8.sent;\n\n          if (getUsername) {\n            _context8.next = 11;\n            break;\n          }\n\n          params = {\n            \"username\": \"anonymous\",\n            \"password\": generatePassword(24),\n            \"anonymous\": true\n          };\n          _context8.next = 7;\n          return _regeneratorRuntime.awrap(registerUser(params));\n\n        case 7:\n          _context8.next = 9;\n          return _regeneratorRuntime.awrap(authenticateUser({}));\n\n        case 9:\n          _context8.next = 13;\n          break;\n\n        case 11:\n          _context8.next = 13;\n          return _regeneratorRuntime.awrap(authenticateUser({}));\n\n        case 13:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction generatePassword(length) {\n  var result = \"\";\n  var characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  var charactersLength = characters.length;\n\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n\n  return result;\n}","map":{"version":3,"names":["axios","config","getSecuretValueFor","secureSave","deleteSecuretValueFor","module","exports","registerUser","authenticateUser","updateUser","logoutUser","firstLaunch","baseURL","baseUrl","params","getUsername","username","password","method","url","headers","data","JSON","stringify","then","response","token","String","id","catch","error","console","log","anonymous","generatePassword","message","length","result","characters","charactersLength","i","charAt","Math","floor","random"],"sources":["C:/Users/lyes9/Documents/GitHub/stepnstats/stepnstats/front/services/users/index.js"],"sourcesContent":["import axios from \"axios\";\r\nimport config from \"../../config.json\";\r\nimport { getSecuretValueFor, secureSave, deleteSecuretValueFor } from \"../secureStorage/index\";\r\n\r\nmodule.exports = {\r\n  registerUser,\r\n  authenticateUser,\r\n  updateUser,\r\n  logoutUser,\r\n  firstLaunch\r\n};\r\nconst baseURL = config.baseUrl + \"/users\";\r\n\r\nasync function authenticateUser(params) {\r\n  var getUsername = await getSecuretValueFor(\"username\");\r\n  if (getUsername) {\r\n    params.username = getUsername;\r\n    params.password = await getSecuretValueFor(\"password\");\r\n  }\r\n  var config = {\r\n    method: \"post\",\r\n    url: baseURL + \"/authenticate\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      // Save username and password\r\n      await secureSave(\"token\", response.data.token);\r\n      await secureSave(\"id\", String(response.data.id));\r\n      // Login\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error);\r\n    });\r\n}\r\n\r\nasync function registerUser(params) {\r\n  if (params.anonymous) {\r\n    // Generate password\r\n    params.password = generatePassword(24);\r\n  }\r\n\r\n  var config = {\r\n    method: \"post\",\r\n    url: baseURL + \"/register\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      // Save username and password\r\n      await secureSave(\"username\", response.data.username);\r\n      await secureSave(\"password\", params.password);\r\n      await secureSave(\"anonymous\", String(params.anonymous));\r\n      // Login\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function updateUser(params) {\r\n  var anonymous = await getSecuretValueFor(\"anonymous\")\r\n  if (anonymous) {\r\n    params.anonymous = false;\r\n  }\r\n  var id = await getSecuretValueFor(\"id\");\r\n  var token = await getSecuretValueFor(\"token\");\r\n\r\n  var config = {\r\n    method: \"put\",\r\n    url: baseURL + \"/\" + id,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      \"Authorization\": `Bearer ${token}`\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      // Save username and password\r\n      await secureSave(\"username\", response.data.username);\r\n      await secureSave(\"password\", params.password);\r\n      await secureSave(\"anonymous\", String(params.anonymous));\r\n      // Login\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function logoutUser(){\r\n  await deleteSecuretValueFor(\"token\")\r\n  await deleteSecuretValueFor(\"password\")\r\n  await deleteSecuretValueFor(\"username\")\r\n  await deleteSecuretValueFor(\"id\")\r\n  await deleteSecuretValueFor(\"anonymous\") \r\n}\r\n\r\nasync function firstLaunch(){\r\n  var getUsername = await getSecuretValueFor(\"username\");\r\n  if(!getUsername){\r\n    var params = {\r\n        \"username\": \"anonymous\",\r\n        \"password\": generatePassword(24),\r\n        \"anonymous\": true\r\n      }\r\n    await registerUser(params)\r\n    await authenticateUser({})\r\n  }else{\r\n    await authenticateUser({})\r\n  }\r\n}\r\n\r\nfunction generatePassword(length) {\r\n  var result = \"\";\r\n  var characters =\r\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  var charactersLength = characters.length;\r\n  for (var i = 0; i < length; i++) {\r\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n  }\r\n  return result;\r\n}\r\n\r\n"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP;AACA,SAASC,kBAAT,EAA6BC,UAA7B,EAAyCC,qBAAzC;AAEAC,MAAM,CAACC,OAAP,GAAiB;EACfC,YAAY,EAAZA,YADe;EAEfC,gBAAgB,EAAhBA,gBAFe;EAGfC,UAAU,EAAVA,UAHe;EAIfC,UAAU,EAAVA,UAJe;EAKfC,WAAW,EAAXA;AALe,CAAjB;AAOA,IAAMC,OAAO,GAAGX,MAAM,CAACY,OAAP,GAAiB,QAAjC;;AAEA,SAAeL,gBAAf,CAAgCM,MAAhC;EAAA;EAAA;IAAA;MAAA;QAAA;UAAA;UAAA,iCAC0BZ,kBAAkB,CAAC,UAAD,CAD5C;;QAAA;UACMa,WADN;;UAAA,KAEMA,WAFN;YAAA;YAAA;UAAA;;UAGID,MAAM,CAACE,QAAP,GAAkBD,WAAlB;UAHJ;UAAA,iCAI4Bb,kBAAkB,CAAC,UAAD,CAJ9C;;QAAA;UAIIY,MAAM,CAACG,QAJX;;QAAA;UAMMhB,MANN,GAMe;YACXiB,MAAM,EAAE,MADG;YAEXC,GAAG,EAAEP,OAAO,GAAG,eAFJ;YAGXQ,OAAO,EAAE;cACP,gBAAgB;YADT,CAHE;YAMXC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeT,MAAf;UANK,CANf;UAAA;UAAA,iCAeQd,KAAK,CAACC,MAAD,CAAL,CACHuB,IADG,CACE,iBAAgBC,QAAhB;YAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,iCAEEtB,UAAU,CAAC,OAAD,EAAUsB,QAAQ,CAACJ,IAAT,CAAcK,KAAxB,CAFZ;;kBAAA;oBAAA;oBAAA,iCAGEvB,UAAU,CAAC,IAAD,EAAOwB,MAAM,CAACF,QAAQ,CAACJ,IAAT,CAAcO,EAAf,CAAb,CAHZ;;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA,CADF,EAOHC,KAPG,CAOG,UAAUC,KAAV,EAAiB;YACtBC,OAAO,CAACC,GAAR,CAAYF,KAAZ;UACD,CATG,CAfR;;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA;;AA2BA,SAAevB,YAAf,CAA4BO,MAA5B;EAAA;EAAA;IAAA;MAAA;QAAA;UACE,IAAIA,MAAM,CAACmB,SAAX,EAAsB;YAEpBnB,MAAM,CAACG,QAAP,GAAkBiB,gBAAgB,CAAC,EAAD,CAAlC;UACD;;UAEGjC,MANN,GAMe;YACXiB,MAAM,EAAE,MADG;YAEXC,GAAG,EAAEP,OAAO,GAAG,WAFJ;YAGXQ,OAAO,EAAE;cACP,gBAAgB;YADT,CAHE;YAMXC,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeT,MAAf;UANK,CANf;UAAA;UAAA,iCAeQd,KAAK,CAACC,MAAD,CAAL,CACHuB,IADG,CACE,kBAAgBC,QAAhB;YAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,iCAEEtB,UAAU,CAAC,UAAD,EAAasB,QAAQ,CAACJ,IAAT,CAAcL,QAA3B,CAFZ;;kBAAA;oBAAA;oBAAA,iCAGEb,UAAU,CAAC,UAAD,EAAaW,MAAM,CAACG,QAApB,CAHZ;;kBAAA;oBAAA;oBAAA,iCAIEd,UAAU,CAAC,WAAD,EAAcwB,MAAM,CAACb,MAAM,CAACmB,SAAR,CAApB,CAJZ;;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA,CADF,EAQHJ,KARG,CAQG,UAAUC,KAAV,EAAiB;YACtBC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACL,QAAN,CAAeJ,IAAf,CAAoBc,OAAhC;UACD,CAVG,CAfR;;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA;;AA4BA,SAAe1B,UAAf,CAA0BK,MAA1B;EAAA;EAAA;IAAA;MAAA;QAAA;UAAA;UAAA,iCACwBZ,kBAAkB,CAAC,WAAD,CAD1C;;QAAA;UACM+B,SADN;;UAEE,IAAIA,SAAJ,EAAe;YACbnB,MAAM,CAACmB,SAAP,GAAmB,KAAnB;UACD;;UAJH;UAAA,iCAKiB/B,kBAAkB,CAAC,IAAD,CALnC;;QAAA;UAKM0B,EALN;UAAA;UAAA,iCAMoB1B,kBAAkB,CAAC,OAAD,CANtC;;QAAA;UAMMwB,KANN;UAQMzB,MARN,GAQe;YACXiB,MAAM,EAAE,KADG;YAEXC,GAAG,EAAEP,OAAO,GAAG,GAAV,GAAgBgB,EAFV;YAGXR,OAAO,EAAE;cACP,gBAAgB,kBADT;cAEP,6BAA2BM;YAFpB,CAHE;YAOXL,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeT,MAAf;UAPK,CARf;UAAA;UAAA,iCAkBQd,KAAK,CAACC,MAAD,CAAL,CACHuB,IADG,CACE,kBAAgBC,QAAhB;YAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,iCAEEtB,UAAU,CAAC,UAAD,EAAasB,QAAQ,CAACJ,IAAT,CAAcL,QAA3B,CAFZ;;kBAAA;oBAAA;oBAAA,iCAGEb,UAAU,CAAC,UAAD,EAAaW,MAAM,CAACG,QAApB,CAHZ;;kBAAA;oBAAA;oBAAA,iCAIEd,UAAU,CAAC,WAAD,EAAcwB,MAAM,CAACb,MAAM,CAACmB,SAAR,CAApB,CAJZ;;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA,CADF,EAQHJ,KARG,CAQG,UAAUC,KAAV,EAAiB;YACtBC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACL,QAAN,CAAeJ,IAAf,CAAoBc,OAAhC;UACD,CAVG,CAlBR;;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA;;AA+BA,SAAezB,UAAf;EAAA;IAAA;MAAA;QAAA;UAAA;UAAA,iCACQN,qBAAqB,CAAC,OAAD,CAD7B;;QAAA;UAAA;UAAA,iCAEQA,qBAAqB,CAAC,UAAD,CAF7B;;QAAA;UAAA;UAAA,iCAGQA,qBAAqB,CAAC,UAAD,CAH7B;;QAAA;UAAA;UAAA,iCAIQA,qBAAqB,CAAC,IAAD,CAJ7B;;QAAA;UAAA;UAAA,iCAKQA,qBAAqB,CAAC,WAAD,CAL7B;;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA;;AAQA,SAAeO,WAAf;EAAA;EAAA;IAAA;MAAA;QAAA;UAAA;UAAA,iCAC0BT,kBAAkB,CAAC,UAAD,CAD5C;;QAAA;UACMa,WADN;;UAAA,IAEMA,WAFN;YAAA;YAAA;UAAA;;UAGQD,MAHR,GAGiB;YACT,YAAY,WADH;YAET,YAAYoB,gBAAgB,CAAC,EAAD,CAFnB;YAGT,aAAa;UAHJ,CAHjB;UAAA;UAAA,iCAQU3B,YAAY,CAACO,MAAD,CARtB;;QAAA;UAAA;UAAA,iCASUN,gBAAgB,CAAC,EAAD,CAT1B;;QAAA;UAAA;UAAA;;QAAA;UAAA;UAAA,iCAWUA,gBAAgB,CAAC,EAAD,CAX1B;;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA;;AAeA,SAAS0B,gBAAT,CAA0BE,MAA1B,EAAkC;EAChC,IAAIC,MAAM,GAAG,EAAb;EACA,IAAIC,UAAU,GACZ,gEADF;EAEA,IAAIC,gBAAgB,GAAGD,UAAU,CAACF,MAAlC;;EACA,KAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,MAApB,EAA4BI,CAAC,EAA7B,EAAiC;IAC/BH,MAAM,IAAIC,UAAU,CAACG,MAAX,CAAkBC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBL,gBAA3B,CAAlB,CAAV;EACD;;EACD,OAAOF,MAAP;AACD"},"metadata":{},"sourceType":"module"}