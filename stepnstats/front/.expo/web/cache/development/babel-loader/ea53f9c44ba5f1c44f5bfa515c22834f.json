{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport axios from \"axios\";\nimport config from \"../../config.json\";\nimport { getSecuretValueFor, secureSave, deleteSecuretValueFor } from \"../secureStorage/index\";\nmodule.exports = {\n  createRun: createRun,\n  deleteRun: deleteRun,\n  uploadRun: uploadRun,\n  updateRun: updateRun,\n  getAllMyRun: getAllMyRun\n};\nvar baseURL = config.baseUrl + \"/runs\";\n\nfunction createRun(params) {\n  var token, config;\n  return _regeneratorRuntime.async(function createRun$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 2:\n          token = _context2.sent;\n          config = {\n            method: \"post\",\n            url: baseURL + \"/create\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            },\n            data: JSON.stringify(params)\n          };\n          _context2.next = 6;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee(response) {\n            return _regeneratorRuntime.async(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    console.log(response);\n\n                  case 1:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 6:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction updateRun(id, params) {\n  var token, config;\n  return _regeneratorRuntime.async(function updateRun$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 2:\n          token = _context4.sent;\n          config = {\n            method: \"put\",\n            url: baseURL + \"/\" + id,\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            },\n            data: JSON.stringify(params)\n          };\n          _context4.next = 6;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee2(response) {\n            return _regeneratorRuntime.async(function _callee2$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    console.log(response.data);\n\n                  case 1:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 6:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction uploadRun(image, realm) {\n  var token, uriParts, fileType, formData, options;\n  return _regeneratorRuntime.async(function uploadRun$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          if (image.cancelled) {\n            _context8.next = 12;\n            break;\n          }\n\n          _context8.next = 3;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 3:\n          token = _context8.sent;\n          uriParts = image.uri.split(\".\");\n          fileType = uriParts[uriParts.length - 1];\n          formData = new FormData();\n          formData.append(\"file\", {\n            uri: image.uri,\n            name: \"photo.\" + fileType,\n            type: \"image/\" + fileType\n          });\n          formData.append(\"realm\", JSON.stringify({\n            realm: realm\n          }));\n          options = {\n            method: \"POST\",\n            body: formData,\n            headers: {\n              Accept: \"application/json\",\n              Authorization: \"Bearer \" + token,\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          };\n          _context8.next = 12;\n          return _regeneratorRuntime.awrap(fetch(baseURL + \"/upload\", options).then(function _callee3(response) {\n            return _regeneratorRuntime.async(function _callee3$(_context5) {\n              while (1) {\n                switch (_context5.prev = _context5.next) {\n                  case 0:\n                    if (!response.ok) {\n                      _context5.next = 4;\n                      break;\n                    }\n\n                    _context5.next = 3;\n                    return _regeneratorRuntime.awrap(response.json());\n\n                  case 3:\n                    return _context5.abrupt(\"return\", _context5.sent);\n\n                  case 4:\n                    _context5.next = 6;\n                    return _regeneratorRuntime.awrap(response.json());\n\n                  case 6:\n                    throw _context5.sent;\n\n                  case 7:\n                  case \"end\":\n                    return _context5.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).then(function _callee4(response) {\n            return _regeneratorRuntime.async(function _callee4$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    _context6.next = 2;\n                    return _regeneratorRuntime.awrap(response);\n\n                  case 2:\n                    return _context6.abrupt(\"return\", _context6.sent);\n\n                  case 3:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function _callee5(error) {\n            return _regeneratorRuntime.async(function _callee5$(_context7) {\n              while (1) {\n                switch (_context7.prev = _context7.next) {\n                  case 0:\n                    _context7.next = 2;\n                    return _regeneratorRuntime.awrap(error.message);\n\n                  case 2:\n                    throw _context7.sent;\n\n                  case 3:\n                  case \"end\":\n                    return _context7.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }));\n\n        case 12:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction deleteRun(id) {\n  var token, config;\n  return _regeneratorRuntime.async(function deleteRun$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 2:\n          token = _context10.sent;\n          config = {\n            method: \"delete\",\n            url: baseURL + \"/\" + id,\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            }\n          };\n          _context10.next = 6;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee6(response) {\n            return _regeneratorRuntime.async(function _callee6$(_context9) {\n              while (1) {\n                switch (_context9.prev = _context9.next) {\n                  case 0:\n                    console.log(response.data);\n\n                  case 1:\n                  case \"end\":\n                    return _context9.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 6:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction getAllMyRun(page) {\n  var token, config;\n  return _regeneratorRuntime.async(function getAllMyRun$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          _context12.next = 2;\n          return _regeneratorRuntime.awrap(getSecuretValueFor(\"token\"));\n\n        case 2:\n          token = _context12.sent;\n          config = {\n            method: \"get\",\n            url: baseURL + \"/my\",\n            params: {\n              page: page\n            },\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            }\n          };\n          _context12.next = 6;\n          return _regeneratorRuntime.awrap(axios(config).then(function _callee7(response) {\n            return _regeneratorRuntime.async(function _callee7$(_context11) {\n              while (1) {\n                switch (_context11.prev = _context11.next) {\n                  case 0:\n                    return _context11.abrupt(\"return\", response.data.rows);\n\n                  case 1:\n                  case \"end\":\n                    return _context11.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          }).catch(function (error) {\n            console.log(error.response.data.message);\n          }));\n\n        case 6:\n          return _context12.abrupt(\"return\", _context12.sent);\n\n        case 7:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}","map":{"version":3,"names":["axios","config","getSecuretValueFor","secureSave","deleteSecuretValueFor","module","exports","createRun","deleteRun","uploadRun","updateRun","getAllMyRun","baseURL","baseUrl","params","token","method","url","headers","Authorization","data","JSON","stringify","then","response","console","log","catch","error","message","id","image","realm","cancelled","uriParts","uri","split","fileType","length","formData","FormData","append","name","type","options","body","Accept","fetch","ok","json","page","rows"],"sources":["C:/Users/lyes9/Documents/GitHub/stepnstats/stepnstats/front/services/runs/index.js"],"sourcesContent":["import axios from \"axios\";\r\nimport config from \"../../config.json\";\r\nimport {\r\n  getSecuretValueFor,\r\n  secureSave,\r\n  deleteSecuretValueFor,\r\n} from \"../secureStorage/index\";\r\n\r\nmodule.exports = {\r\n  createRun,\r\n  deleteRun,\r\n  uploadRun,\r\n  updateRun,\r\n  getAllMyRun,\r\n};\r\nconst baseURL = config.baseUrl + \"/runs\";\r\n\r\nasync function createRun(params) {\r\n  var token = await getSecuretValueFor(\"token\");\r\n  var config = {\r\n    method: \"post\",\r\n    url: baseURL + \"/create\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      // Save to store\r\n      console.log(response);\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function updateRun(id, params) {\r\n  var token = await getSecuretValueFor(\"token\");\r\n\r\n  var config = {\r\n    method: \"put\",\r\n    url: baseURL + \"/\" + id,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    data: JSON.stringify(params),\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      console.log(response.data);\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function uploadRun(image, realm) {\r\n  if (!image.cancelled) {\r\n    var token = await getSecuretValueFor(\"token\");\r\n    let uriParts = image.uri.split(\".\");\r\n    let fileType = uriParts[uriParts.length - 1];\r\n    let formData = new FormData();\r\n    formData.append(\"file\", {\r\n      uri: image.uri,\r\n      name: `photo.${fileType}`,\r\n      type: `image/${fileType}`,\r\n    });\r\n    formData.append(\"realm\", JSON.stringify({ realm }));\r\n    let options = {\r\n      method: \"POST\",\r\n      body: formData,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    };\r\n    // Start waiting screen\r\n    await fetch(baseURL + \"/upload\", options)\r\n      .then(async (response) => {\r\n        if (response.ok) {\r\n          return await response.json();\r\n        }\r\n        throw await response.json();\r\n      })\r\n      .then(async (response) => {\r\n        return await response;\r\n      })\r\n      .catch(async function (error) {\r\n        throw await error.message;\r\n      });\r\n  }\r\n}\r\n\r\nasync function deleteRun(id) {\r\n  var token = await getSecuretValueFor(\"token\");\r\n  var config = {\r\n    method: \"delete\",\r\n    url: baseURL + \"/\" + id,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  };\r\n\r\n  await axios(config)\r\n    .then(async function (response) {\r\n      console.log(response.data);\r\n      // re run getAllMyRun to actualize\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n\r\nasync function getAllMyRun(page) {\r\n  var token = await getSecuretValueFor(\"token\");\r\n  var config = {\r\n    method: \"get\",\r\n    url: baseURL + \"/my\",\r\n    params: { page: page },\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  };\r\n\r\n  return await axios(config)\r\n    .then(async function (response) {\r\n      return response.data.rows;\r\n      // Set store with the data\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response.data.message);\r\n    });\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}